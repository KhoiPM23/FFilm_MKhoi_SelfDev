<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${categoryTitle}">Danh sách phim</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        background: #141414;
        color: #ffffff;
        padding-top: 70px;
      }

      .main-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 70px;
        background: rgba(20, 20, 20, 0.95);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 50px;
        z-index: 1000;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .category-header {
        padding: 40px 50px 20px;
        border-bottom: 2px solid #e50914;
      }

      .category-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .category-info {
        display: flex;
        gap: 20px;
        align-items: center;
        color: #999;
        font-size: 0.95rem;
      }

      .movie-grid {
        padding: 40px 50px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 25px;
      }

      .movie-card {
        cursor: pointer;
        transition: transform 0.3s ease;
        position: relative;
      }

      .movie-card:hover {
        transform: scale(1.05);
        z-index: 10;
      }

      .movie-poster {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      }

      .movie-poster img {
        width: 100%;
        height: 300px;
        object-fit: cover;
        display: block;
      }

      .movie-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.9) 0%,
          transparent 60%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .movie-card:hover .movie-overlay {
        opacity: 1;
      }

      .play-btn {
        width: 60px;
        height: 60px;
        background: rgba(229, 9, 20, 0.9);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .play-btn:hover {
        background: #e50914;
        transform: scale(1.1);
      }

      .movie-info {
        padding: 12px 0;
      }

      .movie-info h3 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 5px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .movie-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: #999;
      }

      .movie-rating {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #46d369;
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 40px 50px;
      }

      .page-btn {
        padding: 10px 18px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        font-size: 0.95rem;
      }

      .page-btn:hover:not(:disabled) {
        background: rgba(229, 9, 20, 0.8);
        border-color: #e50914;
      }

      .page-btn.active {
        background: #e50914;
        border-color: #e50914;
        font-weight: 600;
      }

      .page-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .page-numbers {
        display: flex;
        gap: 5px;
      }

      .error-message {
        text-align: center;
        padding: 60px 20px;
        color: #999;
        font-size: 1.1rem;
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 6px;
        text-decoration: none;
        transition: all 0.3s;
        margin-bottom: 20px;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Loading state */
      .loading {
        text-align: center;
        padding: 60px 20px;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top-color: #e50914;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .movie-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 15px;
          padding: 20px;
        }

        .category-header {
          padding: 20px;
        }

        .category-title {
          font-size: 1.8rem;
        }

        .pagination {
          padding: 30px 20px;
          flex-wrap: wrap;
        }

        .page-numbers {
          order: 3;
          width: 100%;
          justify-content: center;
          margin-top: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div th:replace="fragments/header :: header"></div>

    <div class="category-header">
      <a href="/" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Quay lại trang chủ
      </a>
      <h1 class="category-title" th:text="${categoryTitle}">Danh sách phim</h1>
      <div class="category-info">
        <span th:if="${totalResults}">
          <i class="fas fa-film"></i>
          <span th:text="${totalResults}">0</span> phim
        </span>
        <span
          th:if="${currentPage and totalPages and currentPage > 0 and totalPages > 0}"
        >
          <i class="fas fa-bookmark"></i>
          Trang <span th:text="${currentPage}">1</span> /
          <span th:text="${totalPages}">1</span>
        </span>
      </div>
    </div>

    <div th:if="${errorMessage}" class="error-message">
      <i
        class="fas fa-exclamation-circle"
        style="font-size: 3rem; margin-bottom: 20px"
      ></i>
      <p th:text="${errorMessage}">Có lỗi xảy ra</p>
    </div>

    <div class="movie-grid" th:if="${movies != null && !movies.isEmpty()}">
      <div
        th:each="movie : ${movies}"
        class="movie-card"
        th:onclick="'location.href=\'/movie/detail/' + ${movie.id} + '\''"
      >
        <div class="movie-poster">
          <img
            th:src="${movie.poster}"
            th:alt="${movie.title}"
            onerror="this.src='https://via.placeholder.com/200x300?text=No+Image'"
          />

          <div class="movie-overlay">
            <button class="play-btn">
              <i class="fas fa-play"></i>
            </button>
          </div>
        </div>

        <div class="movie-info">
          <h3 th:text="${movie.title}">Movie Title</h3>
          <div class="movie-meta">
            <span class="movie-rating">
              <i class="fas fa-star"></i>
              <span th:text="${movie.rating}">8.5</span>
            </span>
            <span
              class="movie-year"
              th:if="${movie.releaseDate != null && movie.releaseDate != ''}"
              th:text="${movie.releaseDate.substring(0, 4)}"
            >
              2024
            </span>
          </div>
        </div>
      </div>
    </div>

    <div th:if="${movies == null || movies.isEmpty()}" class="error-message">
      <i
        class="fas fa-film-slash"
        style="font-size: 3rem; margin-bottom: 20px"
      ></i>
      <p>Không tìm thấy phim nào</p>
    </div>

    <!-- Pagination -->
    <div
      class="pagination"
      th:if="${movies != null && !movies.isEmpty() && totalPages > 1}"
    >
      <!-- Previous Button -->
      <a
        th:href="@{${#httpServletRequest.requestURI}(page=${currentPage - 1})}"
        class="page-btn"
        th:classappend="${!hasPrevious} ? 'disabled'"
        th:if="${hasPrevious}"
      >
        <i class="fas fa-chevron-left"></i>
        Trước
      </a>
      <button class="page-btn" disabled th:unless="${hasPrevious}">
        <i class="fas fa-chevron-left"></i>
        Trước
      </button>

      <!-- Page Numbers -->
      <div class="page-numbers">
        <th:block
          th:with="startPage=${currentPage > 3 ? currentPage - 2 : 1},
                               endPage=${currentPage + 2 < totalPages ? currentPage + 2 : totalPages}"
        >
          <!-- First page -->
          <a
            th:if="${startPage > 1}"
            th:href="@{${#httpServletRequest.requestURI}(page=1)}"
            class="page-btn"
            >1</a
          >

          <span th:if="${startPage > 2}" class="page-btn disabled">...</span>

          <!-- Page range -->
          <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
            <a
              th:href="@{${#httpServletRequest.requestURI}(page=${i})}"
              class="page-btn"
              th:classappend="${i == currentPage} ? 'active'"
              th:text="${i}"
              >1</a
            >
          </th:block>

          <!-- Last page -->
          <span th:if="${endPage < totalPages - 1}" class="page-btn disabled"
            >...</span
          >

          <a
            th:if="${endPage < totalPages}"
            th:href="@{${#httpServletRequest.requestURI}(page=${totalPages})}"
            class="page-btn"
            th:text="${totalPages}"
            >100</a
          >
        </th:block>
      </div>

      <!-- Next Button -->
      <a
        th:href="@{${#httpServletRequest.requestURI}(page=${currentPage + 1})}"
        class="page-btn"
        th:classappend="${!hasNext} ? 'disabled'"
        th:if="${hasNext}"
      >
        Sau
        <i class="fas fa-chevron-right"></i>
      </a>
      <button class="page-btn" disabled th:unless="${hasNext}">
        Sau
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <footer
      style="
        padding: 30px 50px;
        background: #0c0c0c;
        text-align: center;
        margin-top: 50px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      "
    >
      <p>© 2025 FFilm</p>
    </footer>

    <script>
      // Smooth scroll to top when changing page
      window.addEventListener("load", function () {
        window.scrollTo(0, 0);
      });

      // Lazy loading images
      if ("IntersectionObserver" in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.src = img.dataset.src || img.src;
              observer.unobserve(img);
            }
          });
        });

        document.querySelectorAll(".movie-poster img").forEach((img) => {
          imageObserver.observe(img);
        });
      }
    </script>
  </body>
</html>
